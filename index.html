<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>간단 가계부</title>
<style>
    body {
        font-family: Arial, sans-serif;
        display: flex;
        margin: 0;
        min-height: 100vh;
    }

    /* 왼쪽 입력 영역 */
    .left {
        width: 40%;
        padding: 20px;
        background: #f4f4f4;
        border-right: 2px solid #ddd;
        display: flex;
        flex-direction: column;
    }

    .left h2, .left h3 {
        text-align: center;
        margin-top: 0;
    }

    .input-section {
        margin-bottom: 20px;
    }

    input {
        width: 100%;
        padding: 10px;
        margin: 5px 0;
        font-size: 16px;
        box-sizing: border-box;
    }

    button, .back-btn {
        width: 100%;
        padding: 10px;
        margin: 5px 0;
        font-size: 16px;
        box-sizing: border-box;
        background: #4CAF50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        text-align: center;
        transition: transform 0.15s ease, box-shadow 0.15s ease;
        box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    }
    .expense-btn {
        background: #f44336;
    }

    button:hover, .back-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 10px rgba(0,0,0,0.2);
    }

    button:active, .back-btn:active {
        transform: translateY(1px);
        box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }

    .modal-header-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

    .back-btn {
        display: inline-block;
        width: auto;
        padding: 8px 12px;
        margin-bottom: 0;
    }

    /* 오른쪽 월별 합계 */
    .right {
        width: 60%;
        padding: 20px;
    }

    .right h2 {
        text-align: center;
    }

    .month {
        padding: 8px;
        border-bottom: 1px solid #ddd;
        font-size: 18px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap; /* 모바일에서 줄바꿈 허용 */
    }
    .month:hover {
        background-color: #eee;
    }

    .total {
        font-weight: bold;
    }
    
    .yearly-total {
        margin-top: 10px;
        padding: 12px 8px;
        border-top: 2px solid #333;
        font-size: 20px;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        background-color: #e8e8e8;
        flex-wrap: wrap; /* 모바일에서 줄바꿈 허용 */
    }

    /* 모달 스타일 */
    .modal {
        display: none; 
        position: fixed; 
        z-index: 1; 
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.4);
    }

    .modal-content {
        background-color: #fefefe;
        margin: 10% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 600px;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    .detail-item {
        display: grid;
        grid-template-columns: 1.5fr 1fr 1fr 1.5fr;
        gap: 10px;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #eee;
    }
    .transaction-item {
        grid-template-columns: 1fr auto;
    }
    .detail-header {
        font-weight: bold;
    }
    .clickable-amount {
        cursor: pointer;
        text-decoration: underline;
    }
    .clickable-amount:hover {
        opacity: 0.7;
    }
    
    .detail-item button,
    .modal-header-controls .expense-btn {
        padding: 2px 5px;
        font-size: 12px;
        width: auto;
    }
    
    /* 반응형 스타일 */
    @media (max-width: 768px) {
        body {
            flex-direction: column;
            height: auto;
        }

        .left,
        .right {
            width: 100%;
            box-sizing: border-box;
            border-right: none;
        }

        .right {
            border-top: 2px solid #ddd;
        }
        
        .month,
        .yearly-total {
            font-size: 16px;
        }

        .modal-content {
            width: 90%;
            margin: 20% auto;
            padding: 15px;
        }
        
        .detail-item {
            grid-template-columns: 1fr 1fr; /* 2열로 변경 */
            gap: 15px;
        }

        .detail-item span:nth-child(3) { /* 지출 */
             grid-column: 2;
        }
        .detail-item span:nth-child(4) { /* 합계 */
            grid-column: 1 / -1; /* 한 줄 전체 차지 */
            text-align: right;
            font-size: 18px;
        }
    }

</style>
</head>
<body>

<div class="left">
    <h2>가계부 입력</h2>
    
    <div class="input-section">
        <label>날짜</label>
        <input type="date" id="date">
    </div>
    
    <hr>

    <div class="input-section">
        <h3>수입</h3>
        <label>금액</label>
        <input type="number" id="income-amount" placeholder="수입 금액">
        <button onclick="addTransaction('income')">수입 추가</button>
    </div>

    <hr>

    <div class="input-section">
        <h3>지출</h3>
        <label>금액</label>
        <input type="number" id="expense-amount" placeholder="지출 금액">
        <button class="expense-btn" onclick="addTransaction('expense')">지출 추가</button>
    </div>
</div>

<div class="right">
    <h2>월별 합계</h2>
    <div id="monthList"></div>
</div>

<!-- 상세내역 모달 -->
<div id="detailsModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h3 id="modalTitle"></h3>
    <div id="modalBody"></div>
  </div>
</div>

<script>
    const dateInput = document.getElementById('date');
    const incomeAmountInput = document.getElementById('income-amount');
    const expenseAmountInput = document.getElementById('expense-amount');

    dateInput.value = new Date().toISOString().slice(0, 10);
    let data = JSON.parse(localStorage.getItem("household")) || [];

    incomeAmountInput.addEventListener('keydown', e => e.key === 'Enter' && addTransaction('income'));
    expenseAmountInput.addEventListener('keydown', e => e.key === 'Enter' && addTransaction('expense'));

    function addTransaction(type) {
        const date = dateInput.value;
        const amount = parseInt((type === 'income' ? incomeAmountInput : expenseAmountInput).value) || 0;

        if (!date) { alert("날짜를 선택하세요."); return; }
        if (amount <= 0) { alert("금액은 0보다 커야 합니다."); return; }

        data.push({ id: Date.now(), date, type, amount });
        localStorage.setItem("household", JSON.stringify(data));

        const amountInput = type === 'income' ? incomeAmountInput : expenseAmountInput;
        amountInput.value = "";
        amountInput.focus();

        render();
    }
    
    function deleteData(id, date, type, month) {
        if(!confirm("이 항목을 삭제하시겠습니까?")) return;

        data = data.filter(item => item.id !== id);
        localStorage.setItem("household", JSON.stringify(data));
        
        render();
        showTransactionDetails(date, type, month);
    }

    function deleteAllTransactions(date, type, month) {
        const typeText = type === 'income' ? '수입' : '지출';
        if (!confirm(`${date}의 모든 ${typeText} 내역을 삭제하시겠습니까?`)) return;

        const idsToDelete = data.filter(item => item.date === date && item.type === type).map(item => item.id);
        data = data.filter(item => !idsToDelete.includes(item.id));
        localStorage.setItem("household", JSON.stringify(data));

        render();
        showDetails(month);
    }

    function render() {
        let monthlySummaries = Array(12).fill(null).map(() => ({ income: 0, expense: 0, total: 0 }));
        let totalIncome = 0;
        let totalExpense = 0;

        data.forEach(item => {
            const month = new Date(item.date).getMonth();
            monthlySummaries[month][item.type] += item.amount;
        });

        let html = "";
        for (let i = 0; i < 12; i++) {
            monthlySummaries[i].total = monthlySummaries[i].income - monthlySummaries[i].expense;
            totalIncome += monthlySummaries[i].income;
            totalExpense += monthlySummaries[i].expense;
            html += `<div class="month" onclick="showDetails(${i})">
                        <span>${i + 1}월</span>
                        <span style="color:blue;">+${monthlySummaries[i].income.toLocaleString()}</span>
                        <span style="color:red;">-${monthlySummaries[i].expense.toLocaleString()}</span>
                        <span class="total">= ${monthlySummaries[i].total.toLocaleString()} 원</span>
                     </div>`;
        }

        const grandTotal = totalIncome - totalExpense;
        html += `<div class="yearly-total">
                     <span>총합계</span>
                     <span style="color:blue;">+${totalIncome.toLocaleString()}</span>
                     <span style="color:red;">-${totalExpense.toLocaleString()}</span>
                     <span class="total">= ${grandTotal.toLocaleString()} 원</span>
                  </div>`;

        document.getElementById("monthList").innerHTML = html;
    }
    
    function showDetails(month) {
        const monthData = data.filter(item => new Date(item.date).getMonth() === month);

        const dailySummary = {};
        monthData.forEach(item => {
            if (!dailySummary[item.date]) {
                dailySummary[item.date] = { income: 0, expense: 0 };
            }
            dailySummary[item.date][item.type] += item.amount;
        });

        const modalTitle = document.getElementById("modalTitle");
        const modalBody = document.getElementById("modalBody");
        modalTitle.innerText = `${month + 1}월 상세 내역`;

        let bodyHtml = `<div class="detail-item detail-header">
                          <span>날짜</span><span>수입/지출</span>
                      </div>`;

        const sortedDates = Object.keys(dailySummary).sort();

        if (sortedDates.length === 0) {
            bodyHtml = "<p>해당 월의 데이터가 없습니다.</p>";
        } else {
            sortedDates.forEach(date => {
                const day = dailySummary[date];
                const total = day.income - day.expense;
                bodyHtml += `<div class="detail-item">
                                <span>${date}</span>
                                <span style="color:blue;" class="clickable-amount" onclick="showTransactionDetails('${date}', 'income', ${month})">+${day.income.toLocaleString()}원</span>
                                <span style="color:red;" class="clickable-amount" onclick="showTransactionDetails('${date}', 'expense', ${month})">-${day.expense.toLocaleString()}원</span>
                                <span style="font-weight:bold;">${total.toLocaleString()}원</span>
                             </div>`;
            });
        }
        
        modalBody.innerHTML = bodyHtml;
        document.getElementById("detailsModal").style.display = "block";
    }

    function showTransactionDetails(date, type, month) {
        const transactions = data.filter(item => item.date === date && item.type === type);
        const modalTitle = document.getElementById("modalTitle");
        const modalBody = document.getElementById("modalBody");
        const typeText = type === 'income' ? '수입' : '지출';

        modalTitle.innerText = `${date} ${typeText} 내역`;

        let bodyHtml = `<div class="modal-header-controls">
                            <div class="back-btn" onclick="showDetails(${month})">⮜ 뒤로가기</div>
                            <button class="expense-btn" onclick="deleteAllTransactions('${date}', '${type}', ${month})">전체 삭제</button>
                        </div>
                        <div class="detail-item transaction-item detail-header">
                            <span>금액</span><span></span>
                        </div>`;

        if (transactions.length === 0) {
            bodyHtml += "<p>해당 내역이 없습니다.</p>";
        } else {
            transactions.forEach(item => {
                bodyHtml += `<div class="detail-item transaction-item">
                                <span style="font-weight:bold;">${item.amount.toLocaleString()}원</span>
                                <button class="expense-btn" onclick="deleteData(${item.id}, '${date}', '${type}', ${month})">삭제</button>
                             </div>`;
            });
        }

        modalBody.innerHTML = bodyHtml;
    }
    
    function closeModal() {
        document.getElementById("detailsModal").style.display = "none";
    }
    
    window.onclick = function(event) {
        if (event.target == document.getElementById("detailsModal")) {
            closeModal();
        }
    }

    render();
</script>

</body>
</html>
